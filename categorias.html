<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    /* no son necesarios */
    .boton-categoria {
      width: 200px;
      height: 100px;
      margin: 10px;
      background-color: lightblue;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .nombre-categoria {
      font-size: 20px;
      color: darkblue;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 16px;
      margin: 16px;
      box-shadow: 2px 2px 12px rgba(0, 0, 0, 0.1);
    }
    .level-bars {
    display: flex;
    gap: 6px;
    cursor: pointer;
}

.level-bars span {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    background: #ddd;
}

.level-bars span.active {
    background: #4caf50;
}
.barras-container {
    display: flex;
    gap: 2px;
}

.barra {
    width: 20px;
    height: 8px;
    background: #ccc; /* barra vac铆a */
}

.barra.rellena {
    background: #4caf50; /* barra rellena */
}

  /* mantener los display */
    .avatar-container{
        width: 300px;
        height: 200px;
        margin-bottom: 20px;
        display: block;
    }
    .con {
        display: none;
        gap: 10px;
    }
   
    .container {
        width: 300px;
        height: 200px;
        cursor: pointer;
    }
   
    img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .contenedor1 {
        display: flex;
        margin: 40px auto;
        width: 50%;
        background: red;
        height: 300px;
        /* mantener la parte lo que pertenece a la animacion */
        scale: 0;
        animation-name: con1;
        animation-duration: 1s;
        animation-fill-mode: forwards;
    }

    @keyframes con1 {
        0% {
            scale: 0;
        }
        100% {
            scale: 1;
        }
    }







  </style>
  <body>
    <!-- crear un js para multiplicar categorias al recibir 1 
    * resivo json
    *decodificarlo de json a js
    *crear tantas categorias como elementos tenga el array que llega
    -->
    <!-- genera botones de forma dinamica -->
    <div
      id="contenedorBotonCategorias"
      class="contenedor-boton-categorias"
      onchange="filtrarCategorias()"
    ></div>

    <section id="mainGrid" class="contenedor-card" onclick="">
      <!-- las cards se generaran automaticamente con js -->

      <!-- container avatar 2d -->
      <div function="generarCards(usuarios)" class="avatar-container">
        <!-- <button id="boton">
            <img class="img"  alt="#"> // revisar que no esta el src de la imagen
        </button> -->
      </div>
      <div id="loading">Cargando...</div>
      <!-- hay que sustituir el id del contenedor -->
      <div id="#"></div>
      <div id="error" style="display: none"></div>
      <div id="no-results" style="display: none">
        No se encontraron usuarios.
      </div>
    </section>

    <script>
      // Variables globales
      let usuarios = [];

      // Funci贸n para mostrar mensajes
      function mostrarMensaje(tipo) {
        const noResults = document.getElementById("no-results");
        if (tipo === "no-results") {
          noResults.style.display = "block";
        } else {
          noResults.style.display = "none";
        }
      }
      // funcion para informacion de usuarios
function verInfoUsuario(id) {
  const container = document.getElementById("cards-container");
  if (!container) return;

  fetch(`obtener_info.php?id=${id}`)
    .then((res) => res.json())
    .then((data) => {
      if (!data.success) throw new Error(data.error || "Error desconocido");

      const usuario = data.data;

      // Generamos una "tarjeta detallada"
      const card = document.createElement("div");
      card.className = "card";

      const skillsHTML =
        usuario.skills.length > 0
          ? usuario.skills
              .map((skill) => `<span class="tag">${skill}</span>`)
              .join("")
          : '<span class="tag">Sin skills</span>';

      const categoriasHTML =
        usuario.categorias.length > 0
          ? usuario.categorias
              .map((cat) => `<span class="tag category">${cat}</span>`)
              .join("")
          : '<span class="tag category">Sin categor铆a</span>';

      

 // Reemplaza la tarjeta anterior
      container.innerHTML = "";
      container.appendChild(card);
    })
    .catch((error) => console.error("Error al obtener info:", error));
}


      // Funci贸n principal para cargar usuarios
      async function cargarUsuarios() {
        const loading = document.getElementById("loading");
        const container = document.getElementById("cards-container");
        const errorDiv = document.getElementById("error");

        try {
          const response = await fetch("obtener_usuarios.php");

          if (!response.ok) {
            throw new Error("Error en la respuesta del servidor");
          }

          const resultado = await response.json();

          loading.style.display = "none";

          if (resultado.success) {
            usuarios = resultado.data;

            if (usuarios.length === 0) {
              mostrarMensaje("no-results");
            } else {
              generarCards(usuarios);
            }
          } else {
            throw new Error(resultado.error || "Error desconocido");
          }
        } catch (error) {
          // estos estilos se generan dinamicamente y se tienen que mantener como esta aca
          loading.style.display = "none";
          errorDiv.style.display = "block";
          errorDiv.textContent =
            "Error al cargar los usuarios: " + error.message;
          console.error("Error:", error);
        }
      }

      //recogida de datos desde un archivo json
      // let obtenerDatos ;
      // fetch(obtenerDatos)
      // .then(response => response.json())
      let obtenerCategorias = "obtener_categorias.php";
      let categorias = [];
      fetch(obtenerCategorias)
        .then((response) => response.json())
        .then((data) => {
          categorias = data.map((cat) => cat.nombre);
          generarCategorias(categorias);
        })
        .catch((error) =>
          console.error("Error al cargar las categor铆as:", error),
        );

      // const contenedorBoton = document.getElementById('contenedorBoton');

      //function generar cards automaticas

      //falta recoger el id desde el backend
      function generarCards(usuarios) {
        let contenedorCard = document.querySelector(".contenedor-card");
        contenedorCard.innerHTML = "";
        //recorrido del array usuarios
        usuarios.forEach((usuario) => {
          let card = document.createElement("div");
          card.classList.add("card");
          // contenedor de lo que tiene dentro la card
          // faltaria incluile las clases de css que necesiten
          //incluir el contenido de modal-tarjetas.html dentro. 
          card.innerHTML = `
          // contenedor general de la card
        <div id="mainGrid">
          // contenedor avatar 2d
          <div class="avatar-container" onclick="con">
            <h3>${usuario.nombre}</h3>
            <img src="${usuario.avatar2D}" alt="Avatar de ${usuario.nombre}">
            <p>Profesi贸n: ${usuario.especializacion}</p>
        </div>
        
        // contenedor avatar 3d y skills
            <div class="avatar-container containerAvatar3d">
                // <button id="boton">
                    <h3>${usuario.nombre}</h3>
                    <img src="${usuario.avatar3D}" alt="Avatar de ${usuario.nombre}">
                    <p>Especializaci贸n: ${usuario.especializacion}</p>
                // </button>
            </div>
            
            <!-- contenedor general de las cards -->
            <div class="containerAvatar3d">
                
              <div class ="card-header-info" >
                  //usuario contiene skills y categorias
                <span>titulo</span>
              </div>
                <div class="contenedor1" id="cards-container">
                  <--contiene la informacion detallada del usuario -->
                </div>
                <div class="card-header-info">
                        <h2>info</h2>
                        <button id="botonCerrar">X</button>
                        // </div>
                </div>

                <div class="card-section">
                        <div class="card-section-title">Nivel Backend</div>
                        ${renderBarras(Number(usuario.backend))}
                </div>

                <div class="card-section">
                        <div class="card-section-title">Nivel Frontend</div>
                        ${renderBarras(Number(usuario.frontend))}
                </div>
                <div>${usuario.descripcion}</div>
                <div>${usuario.enlaces}</div>
                <div class="card-section">
                <--<div class="card-location"> ${usuario.ciudad}, ${usuario.provincia}-->
                <button>contacto</button>
                </div>
            
            </div>
        </div>
        `;
          contenedorCard.appendChild(card);
        });
      }

function renderBarras(nivel) {
  let html = "";
  for (let i = 1; i <= 5; i++) {
    html += `<span class="barra ${i <= nivel ? "rellena" : ""}"></span>`;
  }
  return `<div class="barras-container">${html}</div>`;
}

// ============================
// CARGA DE SKILLS Y CATEGORAS PARA EL FORMULARIO
// ============================
async function cargarSkillsYCategorias() {
  const skillsDiv = document.getElementById("skills-list");
  const catsDiv = document.getElementById("categories-list");
  if (!skillsDiv || !catsDiv) return;

  try {
    const skillsRes = await fetch("obtener_skills.php");
    const skills = await skillsRes.json();

    const catsRes = await fetch("obtener_categorias.php");
    const cats = await catsRes.json();

    skillsDiv.innerHTML = "";
    catsDiv.innerHTML = "";

    skills.forEach((s) => {
      skillsDiv.innerHTML += `
                <label>
                    <input type="checkbox" name="skills[]" value="${s.nombre}">
                    <span>${s.nombre}</span>
                </label>
            `;
    });

    cats.forEach((c) => {
      catsDiv.innerHTML += `
                <label>
                    <input type="checkbox" name="categorias[]" value="${c.nombre}">
                    <span>${c.nombre}</span>
                </label>
            `;
    });
  } catch (error) {
    console.error("Error cargando skills o categor铆as:", error);
  }
}









      //funcion de categorias y filtro por categorias

      //a帽ado contenido dinamico que variaria segun la estructura del boton

      function generarCategorias(categorias) {
        let contenerdorBoton = document.querySelector(
          ".contenedor-boton-categorias",
        );
        contenerdorBoton.innerHTML = "";
        // Bot贸n para mostrar todas
        let botonTodas = document.createElement("button");
        botonTodas.classList.add("boton-categoria");
        botonTodas.onclick = () => filtrarCategorias(null);
        botonTodas.innerHTML = `<span class="nombre-categoria">Todas</span>`;
        contenerdorBoton.appendChild(botonTodas);
        //recorrer el array categorias y crear un boton por cada categoria
        categorias.forEach((categoria) => {
          let boton = document.createElement("button");
          boton.classList.add("boton-categoria");
          boton.onclick = () => filtrarCategorias(categoria);
          boton.innerHTML = `<span class="nombre-categoria">${categoria}</span>`;
          contenerdorBoton.appendChild(boton);
        });
      }
      window.onload = function () {
        cargarUsuarios();
      };

      function filtrarCategorias(categoriaSeleccionada) {
        if (!categoriaSeleccionada) {
          generarCards(usuarios);
          return;
        }
        const usuariosFiltrados = usuarios.filter(
          (usuario) =>
            usuario.categorias &&
            usuario.categorias.includes(categoriaSeleccionada),
        );
        generarCards(usuariosFiltrados);
      }
    </script>
    <script src="modal-tarjetas.js"></script>
  </body>
</html>
